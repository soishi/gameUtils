# デスタップカウンター プロジェクト用項（リポジトリ記載用・初稿）

> 目的: 「デスした回数分、画面をタップしてカウントを進める」だけのシンプルなツール（MVP）を、保守しやすい形で提供する。**コードは本書に含めない。**

---

## 1. プロダクト概要（MVP）

* 名称（仮）: **Death Tap Counter** / 日本語表示名: **デスタップカウンター**
* 想定利用: Splatoon の対戦中に、デス発生時に画面を一度タップしてカウントを+1 する。
* 画面構成: フルスクリーンの大きなタップ領域 + 補助ボタン群（Undo / -1 / 試合確定）。
* 保存: 端末ローカル（LocalStorage など）に現在のカウントと試合履歴を保存。

---

## 2. 機能要件（必須 / MVP 完了条件）

* **タップ加算/減算のゾーニング**: 画面を **縦方向に 7:3** で分割。

  * 上位 70% タップ/クリック → **+1**
  * 下位 30% タップ/クリック → **-1（下限0）**
* **スワイプで試合確定**:

  * **右スワイプ**（一定距離・速度閾値）→ 勝ち試合として **試合確定（W）**
  * **左スワイプ** → 負け試合として **試合確定（L）**
  * 試合確定時に現カウントを履歴へ保存し、カウントは 0 に戻す
* **表示**: 現在のカウントを大きく視認しやすく表示（タブラー数字・高コントラスト）。
* **補助操作**:

  * Undo（直前の+1/-1 の取り消し）
  * ハンバーガーメニュー → **履歴表示**（モーダル/ドロワー）
* **履歴**: 直近最大10件（日時・デス数・試合結果 W/L）。
* **統計**: 平均デス数（小数点1桁丸め）と、W/L 件数のサマリ。
* **永続化**: カウントと履歴はブラウザ再読込後も維持。
* **レスポンシブ**: スマホ/タブレット/PCで主要レイアウトが破綻しない。
* **オフライン**: ネット未接続でもカウント/履歴が利用可能（後述PWAは任意）。

---

## 3. 非機能要件

* **パフォーマンス**: 60fps を意識した滑らかな操作感（アニメ過剰禁止）。
* **アクセシビリティ**: 大きなタップ面、色覚配慮（赤依存禁止）、スクリーンリーダーで主要操作が分かる aria 属性。
* **可用性**: 主要モバイルブラウザ（最新2世代）で動作。

---

## 4. 操作仕様（UI/UX）

* **タップゾーン**: 画面を上 70%（+1）/ 下 30%（-1）に分割。視覚的な境界を薄く表示（誤タップを防ぐ）。
* **スワイプ確定**:

  * 右スワイプ=勝ち（W）確定 / 左スワイプ=負け（L）確定。
  * 閾値: 移動距離 80px 以上 *かつ* 平均速度 0.2px/ms 以上（目安）。
  * 確定時にトーストを表示し、数秒間の「取り消し」アクションを出す（任意）。
* **ハンバーガーメニュー**: 右上に設置。履歴ドロワー（モーダル）へ遷移。

  * 履歴項目: 日時 / デス数 / 結果（W/L）。
  * 先頭に統計サマリ（平均デス・W/L 件数）を表示。
* **キーボード（PC向け任意）**:

  * Space=+1 / ↓=-1 / Z=Undo / →=Wで確定 / ←=Lで確定 / H=履歴を開く
* **視認性**: 現カウントは中央巨大表示、桁増でも崩れないレイアウト。
* **誤操作対策**: 履歴確定時は即時リセットするが、短時間の取り消し導線を用意。

---

## 5. データ仕様

* **保存項目**:

  * `count: number`
  * `history: Array<{ id: string; at: epoch_ms; count: number; result: 'W' | 'L' }>`
  * `stats`（任意キャッシュ）: `{ avg: number; wins: number; losses: number }`
* **保持件数**: 履歴は最大100件、超過した最古を削除。
* **初期化**: 初回起動時は `count=0, history=[]`。
* **エクスポート（任意）**: クリップボードへのテキスト（例: 「W/L: 3/2, 平均デス: 5.4」）。

---

## 6. 技術方針（高レベル）

* **実装**: **Next.js（App Router）で静的書き出ししたシングルページアプリケーション（SPA）** として実装する。

  * `next.config.mjs` で `output: 'export'` を指定（サーバ機能は使用しない）。
  * 画面は 1 ページ（`/`）構成。将来マルチページ化してもクライアントルーティングのみ。
  * すべて **Client Component** で構築し、`server actions` / SSR / Edge機能は不使用。
* **スタイル**: **Tailwind CSS** を採用。

  * `@tailwind base; @tailwind components; @tailwind utilities;` を `app/globals.css` に適用。
  * 数字の視認性向上に `tabular-nums`（Tailwindの任意クラス）を用いる。
  * カラーはダーク基調をデフォルトとし、コントラスト確保。
* **状態**: クライアントのみで完結（サーバ不要）。
* **保存**: LocalStorage（サイズ小、同期不要）。
* **アセット**: `next/image` を使う場合は `images.unoptimized = true` を設定。
* **PWA（任意）**: 将来のホーム追加/オフライン強化に Service Worker（`next-pwa` 等）を検討。

---

## 7. リポジトリ配置・命名

* モノレポ直下 `apps/death-tap-counter/`（仮）。
* Next.js プロジェクト構成（例）:

```
apps/death-tap-counter/
  app/
    page.tsx           # メイン画面（クライアントコンポーネント）
    globals.css        # スタイル（Tailwind 任意）
    layout.tsx         # 1 ページでもレイアウトは定義
  public/              # アイコン類（※公式アセット不可）
  next.config.mjs      # output: 'export' / images.unoptimized 等
  package.json
  tsconfig.json
  postcss.config.mjs   # Tailwind 利用時
  tailwind.config.ts   # Tailwind 利用時
```

* 表示名/英名の一致を README に明記。アイコンはオリジナルのみ（商標等に非依存）。

---

## 9. 品質保証・テスト方針

* **Lint/型**: ESLint（flat）/ TypeScript strict。
* **ユニット（Jest）**:

  * 7:3 ゾーン判定（座標から +1 / -1 が正しく決まる）
  * 右/左スワイプ判定（距離・速度閾値）
  * 試合確定処理（W/L で履歴追加、カウントリセット、履歴上限ローテ）
  * 平均/勝敗サマリの計算
* **UIテスト（任意）**: Testing Library で基本操作の可視化確認。
* **E2E**: 初期版は省略。
* **CI**: Lint / TypeCheck / Jest / Build。

---

## 12. 拡張候補（参考・今は実装しない）

* 試合タイマー、目標上限アラート、音/触覚フィードバックの切替、PWA、Discord Webhook 連携、シェア画像生成。

---

## 13. 完了の定義（Definition of Done）

* 仕様通りの操作（+1 / -1 / Undo / 右スワイプW確定 / 左スワイプL確定）が一貫して成功し、再読込後も状態が維持される。
* モバイル実機でのタップ領域（7:3）が適切に反応し、誤タップ率が低い。
* 履歴ドロワーで平均と W/L 件数が正しく表示される。
* README に操作説明（ゾーン分割・スワイプ・メニュー）が記載されている。

---

## 14. 初期Issue雛形（作成推奨）

* `feat: 7:3 タップゾーン（+1 / -1）実装`
* `feat: 右スワイプ=W / 左スワイプ=L で試合確定`
* `feat: 履歴ドロワー（平均・W/L サマリ含む）`
* `chore: LocalStorage 保存/復元`
* `test: ゾーン/スワイプ/確定/平均のユニットテスト`
* `docs: README（操作説明/ショートカット）`
